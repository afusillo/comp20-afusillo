<html>

	<head>
		<title>Geolocation Map Example</title>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=true"></script>
		<!--<link rel="stylesheet" href="geolocation_map_style.css" />-->
		<style>

		html {
	height: 100%;
	font-family: Helvetica, "Helvetica Neue", Arial, sans-serif;
}

body {
	height: 100%;
	margin: 0px;
	padding: 0px;
}

#map_canvas {
	width: 100%;
	height: 100%;
}

</style>
		<script>
			var myLat = 0;
			var myLng = 0;
			var me = new google.maps.LatLng(myLat, myLng);
			var Options = {
						zoom: 13, // The larger the zoom number, the bigger the zoom
						center: me,
						mapTypeId: google.maps.MapTypeId.ROADMAP //initially set up map
					};
			var map;
			var marker;
			var students = [];
			var infowindow = new google.maps.InfoWindow(); //GLOBAL INFO WINDOW

			var http = new XMLHttpRequest();



				http.onreadystatechange = function() {  //Call a function when the state changes.
    				if(http.readyState == 4 && http.status == 200) {
    					//alert(http.responseText);
    					var raw = http.responseText;
    					var parsedObjects = JSON.parse(raw);
    				getStudents(parsedObjects);
    				//getLandmarks(parsedObjects);

    			}
    		}


    		
			
			function init()
			{
				map = new google.maps.Map(document.getElementById("map_canvas"), Options);
				getMyLocation();
			}
			
			function getMyLocation() {
				if (navigator.geolocation) { // the navigator.geolocation object is supported on your browser
					navigator.geolocation.getCurrentPosition(function(position) {
						myLat = position.coords.latitude;
						myLng = position.coords.longitude;
						var me= new google.maps.LatLng(myLat, myLng);
						map.panTo(me);

					var url = "https://defense-in-derpth.herokuapp.com/sendLocation";
					var params = "login=JAY_GUTIERREZ&lat="+myLat+"&lng="+myLng;
					http.open("POST", url, true);
					http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
					http.send(params);

						//renderMap();
					});
				}
			}

			/*function renderMap() {

				me = new google.maps.LatLng(myLat, myLng);
				

				// Update map and go there...
				map.panTo(me);


				//Create a marker
				marker = new google.maps.Marker({
					position: me,
					title: "<h1>HELLO IT ME</h1>" + "<p>" + myLat + "   " + myLng + "</p>"
				});
				marker.setMap(map);
					
				// Open info window on click of marker
				google.maps.event.addListener(marker, 'click', function() {
					infowindow.setContent(marker.title);
					infowindow.open(map, marker); //THIS IS UNIVERSAL
				}

					var url = "https://defense-in-derpth.herokuapp.com/sendLocation";
					var params = "login=JayGutierrez&lat="+myLat+"&lng="+myLng;
					http.open("POST", url, true);
					http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
					http.send(params);

			
					});
				}
				else {
					alert("Geolocation is not supported by your web browser.  What a shame!");
				}
			}


*/


  			
			function getStudents(data){

			for (i = 0; i < data['people'].length; i++) {
				var sname = data['people'][i]['login'];
				var slat = data['people'][i]['lat'];
				var slng = data['people'][i]['lng'];
				var slocation = new google.maps.LatLng(slat, slng);
				var newstudent = {name: sname, location: slocation};

				students[students.length] = newstudent;
				//make marker
				var marker = new google.maps.Marker({
					position: students[i]['location'],
					//map: map,
					title: "Login: " + sname + "<br>Lat: " + slat + " Lng: " + slng,
				});
    		
				

    				marker.setMap(map);

    				google.maps.event.addListener(marker, 'click', function () {
    					infowindow.setContent(this.title);
						
						infowindow.open(map, this); 
    				});
    			}
    		}





			//Send the proper header information along with the request

				



    			
    		
    			/*					
    				raw = http.responseText;
    				parsedObjects = JSON.parse(raw);
    				var latit = parsedObjects["people"][1]["lat"];
    				var longit = parsedObjects["people"][1]["lng"];

    				var them = new google.maps.LatLng(latit, longit);
				

    				maker = new google.maps.Marker({
    					position: them,
    					title: "HELLO"
    				});
    				maker.setMap(map);

    				google.maps.event.addListener(maker, 'click', function () {
    					infowindow.setContent(maker.title);
						infowindow.open(map, maker); 
    				});
    			}
    			*/
    		
   
        			/*raw = http.responseText;
        			 parsedObjects = JSON.parse(raw);
        			 markers= new Array();

        			 for (i = 0; i < parsedObjects["people"].length; i++) {

        			 		latit= parsedObjects["people"][i]["lat"]
        			 		longit= parsedObjects["people"][i]["lng"]

        			 		them = new google.maps.LatLng(latit, longit);

      


        					markers[i] = new google.maps.Marker({
							position: them,
							title: "<p>" + parsedObjects["people"][i]["login"] + "</p>"
							});
						markers[i].setMap(map);

        			 	google.maps.event.addListener(markers[i], 'click', function() {
						infowindow.setContent(markers[i].title);
						infowindow.open(map, markers[i]); 
						//THIS IS UNIVERSAL
						});

        			}
        			*/
   


/*
			function renderMap()
			{
				me = new google.maps.LatLng(myLat, myLng);

				map.panTo(me);
	
				// Create a marker
				marker = new google.maps.Marker({
					position: me,
					title: "<h1>HELLO IT ME</h1>" + "<p>" + myLat + "   " + myLng + "</p>"
				});
				marker.setMap(map);
					
				// Open info window on click of marker
				google.maps.event.addListener(marker, 'click', function() {
					infowindow.setContent(marker.title);
					infowindow.open(map, marker); //THIS IS UNIVERSAL
				});
			}
	*/		
		</script>
	</head>
	
	<body onload="init()">
		<div id="map_canvas"></div>
	</body>




